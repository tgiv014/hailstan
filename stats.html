<html>
<head>
	<link rel="stylesheet" type="text/css" href="/styles.css">
</head>
<body>
	<div id="cover">
		<div id="loader">
			<h1>Hold up</h1>
			<img id="spinner" src="/load.gif">
			<h3>Connecting<span id="extra">...</span></h3>
		</div>
	</div>
	<canvas id="myChart" width="400" height="400"></canvas>
	<a href="http://nodejs.org/"><img id="logo" src="http://nodejs.org/images/logos/nodejs-black.png"></a>
	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="//rawgithub.com/nnnick/Chart.js/master/Chart.min.js"></script>
	<script>
		$(window).load(function(){
			var socket = io.connect('http://hailstan.com');
			jQuery.fn.center = function () {
				this.css("position", "absolute");
				this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop()) + "px");
				this.css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) + $(window).scrollLeft()) + "px");
				return this;
			}
			var pieData = [];
			//Get context with jQuery - using jQuery's .get() method.
			var ctx = $("#myChart").get(0).getContext("2d");
			//This will get the first returned node in the jQuery collection.
			var pie = new Chart(ctx);

			$('#loader').center();
			$(window).resize(function () {
				$('#loader').center();
			});
			setTimeout(function() {
				$('#extra').text('... Damn it.')
				$('#loader').center();
			}, 10000);
			socket.on('connect',function(){
				$('#cover').fadeOut(400,function(){
					$('#cover').remove();
				});
				socket.emit('getdata', { hey: 'yo'});
				console.log('Sent request');
			});
			drawcenter = function() {
				ctx..font = 'italic 40pt Calibri';
				ctx.fillText('Hello World!', 150, 100);
				console.log('drawing center');
			}
			changeoptions = function () {
				options = {
        //Boolean - Whether we should animate the chart	
        animation: false,
        //Function - Will fire on animation completion.
        onAnimationComplete: drawcenter
    }
    drawcenter();
    console.log('disabled animation');
}
options = {
    //Boolean - Whether we should animate the chart	
    animation: true,
    //Function - Will fire on animation completion.
    onAnimationComplete: changeoptions
}
socket.on('data', function (data) {
	console.log('Received Response!');
	console.log(data);
	if(data!=pieData){
		pie.Doughnut(data,options);
		pieData=data;
	}else{
		console.log('No change');
	}
});
});
</script>
</body>
<html>